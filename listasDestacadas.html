<!DOCTYPE html>
<html lang="en">

<head>
  	
  <link  rel="icon"   href="logo.png" type="image/png" />
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="">
  <meta name="author" content="">

  <title>BookApp</title>

  <!-- Bootstrap core CSS -->
  <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">

  <!-- Custom styles for this template -->
  <link href="css/simple-sidebar.css" rel="stylesheet">

</head>

<body style="background-color: #ff9966;">

  <div class="d-flex" id="wrapper">

    <!-- Sidebar -->
    <div class="border-right bg-dark" id="sidebar-wrapper">
      <div class="sidebar-heading text-light"><img  src="logo.png" style="width:80%;margin-left: 9%;"></div></img>
      <div class="list-group list-group-flush">
        <a href="./index.html" class="list-group-item list-group-item-action bg-dark text-light border-bottom border-top">Inicio</a>
        <a href="#" class="list-group-item list-group-item-action bg-dark text-light border-bottom border-top">Busqueda avanzada</a>
        <a href="./listasDestacadas.html" class="list-group-item list-group-item-action bg-dark text-light border-bottom border-top">Listas Destacadas</a>
        
      </div>
    </div>
    <!-- /#sidebar-wrapper -->

    <!-- Page Content -->
    <div id="page-content-wrapper">

      <nav class="navbar navbar-expand-lg navbar-dark bg-dark border-bottom">
        <button class="btn btn-primary" onclick="changeToggleLabel()" id="menu-toggle" title="Ocultar">Ocultar</button>

        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarSupportedContent">
          <ul class="navbar-nav ml-auto mt-2 mt-lg-0">
            
            <li class="nav-item active">
              <a class="nav-link" href="./index.html">Inicio<span class="sr-only">(current)</span></a>
            </li>
            <li class="nav-item dropdown" style="margin-right: 2%;">
              <a class="nav-link dropdown-toggle"  href="#" id="navbarDropdown" role="button" onclick="getCategories()" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                Categorias
              </a>
              <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown"  id="categorias">
                <div class="text-center">
                  <div class="spinner-border" role="status">
                    <span class="sr-only">Loading...</span>
                  </div>
                </div>
              </div>
            </li>
            <li class="nav-item active">
              <input id="search" class="form-control"  value="" type="search" placeholder="Búsqueda..." aria-label="Búsqueda...">
            </li>
              <li class="nav-item active">
              <button  class="btn btn-primary" style="margin-top: 1%;" onclick="buscarLibro(document.getElementById('search').value)" >Buscar</button>
              </li>
          </ul>
        </div>
      </nav>

      <div class="container-fluid" >
        <h1 id="mainTitle" class="mt-4" style="text-align: center;">Los libros mas leidos</h1>
        <!---->
        
        <div id="orderFilter" hidden="true" class="container border-top border-bottom">
          <div id="leftThing" >
          <h5 class="mt-2">Ordenar por</h5>
          <div class="row" style="padding: 1%;">
            <div class="col-sm-6">
              <select title="Ordena los libros por el atributo seleccionado" id="orderFilterValue" class="form-control"  onchange="orderBooks()">
                <option value="title" >Título</option>
                <option value="author" >Nombre de Autor</option>
                <option value="pages" >Cantidad de paginas</option>
              </select>
            </div>
          </div>
          <div class="row" style="padding: 1%;">
            <div class="col-sm-6">
              <select id="orderType" class="form-control" onchange="orderBooks()" >
                <option value="asc" >Ascendente</option>
                <option value="desc">Descendente</option>
              </select>
            </div>
          </div>
          <div class="row" style="margin-left:1%;padding: 3%;">
            
        </div>
          </div>

           <div id="rightThing">
            <!-- Default unchecked -->
            <div class="custom-control custom-checkbox">
              <input type="checkbox" onclick="enableFilter(this.checked)" class="custom-control-input" id="defaultUnchecked">
              <label class="custom-control-label" for="defaultUnchecked"><h5 class="mt-1">Filtrar</h5></label>
            </div>
            <div class="row" style="padding: 1%;">
              <div class="col-sm-6">
                <label for="laguageFilter" class="control-label">Idioma</label>
                <select title="Muestra solo los libros del idioma seleccionado" disabled="true" onchange="filterBooksByLanguage(this.value)" label aria-label="Idioma" id="languageFilter" class="form-control"  onchange="">
                  <option value="ninguno" ></option>
                  <option value="spanish" >Español</option>
                  <option value="english" >Ingles</option>
                </select>
              </div>
            </div>
            <div class="row" style="padding: 1%;">
              <div class="col-sm-6">
                <label for="laguageFilter" class="control-label">Autor</label>
                <select title="Muestra solo los libros del autor seleccionado" disabled="true" onchange="filterBooksByAuthor(this.value)" label aria-label="Idioma" id="authorFilter" class="form-control"  onchange="">
                  <option value="" ></option>
                </select>
              </div>
            </div>
          
           </div>
        </div>
        <!---->
        <!--Contenedor de libros-->
        <div style="margin: 1%;">
          <div id="bookContainer"  style="margin: 1%;">


          </div>
        </div>
        <!--Contenedor de libros-->

      </div>
    </div>
    <!-- /#page-content-wrapper -->

  </div>
  <!-- /#wrapper -->
  <div class="footer-bottom" style="background: white">
    <div class="footerContainer" style="margin-left: 2%;">
        <div class="custom-block f-right" >
          <img src="https://www.bookshop.com.uy/media/pagos/oca.png" style="height: 25px;margin-right: 5px;"> 
          <img src="https://www.bookshop.com.uy/media/pagos/visa.png" style="height: 24px;margin-right: 5px;"> 
          <img src="https://www.bookshop.com.uy/media/pagos/visa.png" style="height: 31px;margin-right: 5px;">
          <img src="https://www.bookshop.com.uy/media/pagos/cabal.png" style="height: 36px;margin-right: 5px;">
          <img src="https://www.bookshop.com.uy/media/pagos/hsbc.png" style="height: 37px;margin-right: 5px;">
          <img src="https://www.bookshop.com.uy/media/pagos/ebrou.png" style="height: 32px;margin-right: 5px;"> 
          <img src="https://www.bookshop.com.uy/media/pagos/abitab.png" style="height: 37px;"> 
        </div>               
        <style type="text/css">
          .footer-bottom .footerContainer:before {
          position: absolute;
          bottom: 0;
          display: none;
          }
        </style>
        <address style="color: #4d4d4d">© 2020 Bookapp. Todos los derechos reservados.</address>
      </div>
  </div>
  <!-- Bootstrap core JavaScript -->
  <script src="vendor/jquery/jquery.min.js"></script>
  <script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
  
  <!-- Menu Toggle Script -->
  <script>
    
    $("#menu-toggle").click(function(e) {
      e.preventDefault();
      $("#wrapper").toggleClass("toggled");
     
    });
  </script>
  <script>
      function init(){
          showSpinner();
        var catIndex = 0;
        var categories = [];
        var booksByCategory = [];
        fetch('https://www.etnassoft.com/api/v1/get/?get_categories=all')
    .then((response) => {
    return response.json();
    }).then((response) => {
        document.getElementById('spinner').hidden = true;
        for(var i in response){
            categories.push(response[i].name);
            var query = "https://www.etnassoft.com/api/v1/get/?category=" + response[i].nicename +"&criteria=most_viewed";          
            fetch(query)
            .then((res) =>{
                return res.json();
                
            }).then((res)=> {
            
            var categoryTitle = document.createElement('h3');
            categoryTitle.innerHTML = categories[catIndex];
            console.log(categories[catIndex]);
            var divCategoria = document.createElement('div');
            divCategoria.setAttribute('class','border-top');
            divCategoria.appendChild(categoryTitle);
            catIndex++;
                for(var i in res){

                    //Crear los div de los libros
                    var nodo = document.createElement('a');
                    nodo.setAttribute("name","libro");
                    nodo.setAttribute("title",res[i].title);
                    nodo.setAttribute("href", res[i].url);
                    var img = document.createElement('img');
                    img.setAttribute("src", res[i].cover);
                    img.setAttribute("alt",res[i].title);
                    img.setAttribute("class","minibox imagenLibro")
                    nodo.appendChild(img);
                    divCategoria.appendChild(nodo);
                }
                document.getElementById('bookContainer').appendChild(divCategoria);
                
            });

        }
});
      }

      function showSpinner(){
    var spinner = document.createElement('div');
    spinner.setAttribute("class","text-center");
    spinner.setAttribute('id','spinner');
    var spinnerNode = document.createElement('div');
    spinnerNode.setAttribute("class","spinner-border");
    spinnerNode.setAttribute("style","width: 5rem; height: 5rem;");
    spinnerNode.setAttribute("role","status");
    var spinnerSpan =document.createElement("span");
    spinnerSpan.setAttribute("class","sr-only");
    spinnerSpan.innerHTML = "Loading ...";
    spinnerNode.appendChild(spinnerSpan);
    spinner.appendChild(spinnerNode);
    bookContainer.appendChild(spinner);
}
      init();
  </script>
  <script src="funciones.js"></script>

</body>

</html>